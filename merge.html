<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merge PDF Files</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <style>
    /* Initially hide inputs for PDF files 3 to 10 */
    #pdf3, #pdf4, #pdf5, #pdf6, #pdf7, #pdf8, #pdf9, #pdf10 {
        display: none;
    }

    .custom-file-input {
        position: relative;
        display: inline-block;
        margin-bottom: 20px; /* Add margin bottom */
    }

    .custom-file-input input[type="file"] {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
        font-family: 'Poppins', sans-serif; /* Apply Poppins font */
    }

    .custom-file-input label {
        padding: 10px 20px;
        font-size: 20px;
        background-color: #99BC85;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-family: 'Poppins', sans-serif; /* Apply Poppins font */
    }

    .custom-file-input button:hover,
    .custom-file-input label:hover {
        background-color: #7FA96A;
    }

    .file-name {
        display: inline-block;
        padding-left: 10px;
        font-size: 16px;
        vertical-align: middle;
        color: #ffffff;
        font-weight: bold;
        font-family: 'Poppins', sans-serif; /* Apply Poppins font */
        background-color: #59ff00;
    }

    /* Ensure all buttons have the same style */
    button {
        padding: 10px 20px;
        font-size: 20px;
        background-color: #99BC85;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        margin-top: 10px;
        font-family: 'Poppins', sans-serif; /* Apply Poppins font */
    }

    button:hover {
        background-color: #7FA96A;
    }

    /* Specific style for the clear button */
    #clearBtn {
        padding: 20px 40px; /* Adjust padding to increase button size */
        font-size: 20px; /* Increase font size */
        border: none; /* Remove border */
        border-radius: 10px; /* Make corners rounded */
    }

    #clearBtn:enabled {
        background-color: #d65858; /* Change background color */
    }

    /* Additional styles for body and card elements */
    body {
        background-color: #BFD8AF;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: 'Poppins', sans-serif; /* Change font to Poppins */
    }

    .card {
        backdrop-filter: blur(10px);
        background-color: #D4E7C5;
        max-width: 700px;
        width: 100%;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        font-family: 'Poppins', sans-serif; /* Change font to Poppins */
        margin-top: 5px;
        border-radius: 10px; /* Add border radius */
        text-align: center; /* Align content to center */
    }

    /* Responsive styles */
    @media only screen and (max-width: 768px) {
        .card {
            max-width: 90%; /* Adjust width for smaller screens */
        }
    }
</style>

</head>
<body>
    
    <div class="card">
        <h1>Merge PDF Files</h1>
        
        <!-- Input fields for PDF files -->
        <div class="custom-file-input" style="margin-bottom: 30px;">
            <label for="pdf1" id="label1">Masukkan Surat:</label>
            <input type="file" id="pdf1" accept="application/pdf" onchange="updateFileName('pdf1', 'file1Name')">
            <span class="file-name" id="file1Name"></span>
        </div>
        <br>

        <div class="custom-file-input" style="margin-bottom: 20px;">
            <label for="pdf2" id="label2">Lampiran 1:</label>
            <input type="file" id="pdf2" accept="application/pdf" onchange="updateFileName('pdf2', 'file2Name')">
            <span class="file-name" id="file2Name"></span>
        </div>
        <br>

        <!-- Inputs for PDF files 3 to 10 -->
        <div class="custom-file-input" id="input3" style="margin-bottom: 20px;">
            <label for="pdf3" id="label3" style="display: none;">Lampiran 2:</label>
            <input type="file" id="pdf3" accept="application/pdf" onchange="updateFileName('pdf3', 'file3Name')">
            <span class="file-name" id="file3Name"></span>
        </div>
        <br>

        <div class="custom-file-input" id="input4" style="margin-bottom: 20px;">
            <label for="pdf4" id="label4" style="display: none;">Lampiran 3:</label>
            <input type="file" id="pdf4" accept="application/pdf" onchange="updateFileName('pdf4', 'file4Name')">
            <span class="file-name" id="file4Name"></span>
        </div>
        <br>

        <div class="custom-file-input" id="input5" style="margin-bottom: 20px;">
            <label for="pdf5" id="label5" style="display: none;">Lampiran 4:</label>
            <input type="file" id="pdf5" accept="application/pdf" onchange="updateFileName('pdf5', 'file5Name')">
            <span class="file-name" id="file5Name"></span>
        </div>
        <br>

        <div class="custom-file-input" id="input6" style="margin-bottom: 20px;">
            <label for="pdf6" id="label6" style="display: none;">Lampiran 5:</label>
            <input type="file" id="pdf6" accept="application/pdf" onchange="updateFileName('pdf6', 'file6Name')">
            <span class="file-name" id="file6Name"></span>
        </div>
        <br>

        <div class="custom-file-input" id="input7" style="margin-bottom: 20px;">
            <label for="pdf7" id="label7" style="display: none;">Lampiran 6:</label>
            <input type="file" id="pdf7" accept="application/pdf" onchange="updateFileName('pdf7', 'file7Name')">
            <span class="file-name" id="file7Name"></span>
        </div>
        <br>

        <div class="custom-file-input" id="input8" style="margin-bottom: 20px;">
            <label for="pdf8" id="label8" style="display: none;">Lampiran 7:</label>
            <input type="file" id="pdf8" accept="application/pdf" onchange="updateFileName('pdf8', 'file8Name')">
            <span class="file-name" id="file8Name"></span>
        </div>
        <br>

        <div class="custom-file-input" id="input9" style="margin-bottom: 20px;">
            <label for="pdf9" id="label9" style="display: none;">Lampiran 8:</label>
            <input type="file" id="pdf9" accept="application/pdf" onchange="updateFileName('pdf9', 'file9Name')">
            <span class="file-name" id="file9Name"></span>
        </div>
        <br>

        <div class="custom-file-input" id="input10" style="margin-bottom: 20px;">
            <label for="pdf10" id="label10" style="display: none;">Lampiran 9:</label>
            <input type="file" id="pdf10" accept="application/pdf" onchange="updateFileName('pdf10', 'file10Name')">
            <span class="file-name" id="file10Name"></span>
        </div>
        
        <!-- Button to merge PDFs -->
        <button class="merge-btn" onclick="mergePdfFiles()">Merge PDFs</button>
        <br><br>
        <!-- Button to remove all input fields -->
        <button id="clearBtn" onclick="removeAllInputs()">Remove All Inputs</button>
        <br><br>
        <!-- Button to go back to the form -->
        <button class="back-btn" onclick="goBack()">Back to Form</button>
        <div class="mb-3">
            <a href="index.php" class="btn btn-primary">Back to Menu</a>
        </div>

        <!-- Placeholder for the merged PDF download link -->
        <div id="uploadedFiles"></div>
    </div>

    <script>
        function goBack() {
            window.history.back(); // Go back to the previous page
        }

        async function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }
        async function mergePdfFiles() {
            // Prompt the user for the desired file name
            const fileName = prompt('Enter the file name (without extension):');
        
            // Array to store PDF array buffers
            const pdfArrayBuffers = [];
        
            // Loop through all input fields and read their files
            for (let i = 1; i <= 10; i++) {
                const fileInput = document.getElementById('pdf' + i);
                if (fileInput.files.length > 0) {
                    const pdfArrayBuffer = await readFileAsArrayBuffer(fileInput.files[0]);
                    pdfArrayBuffers.push(pdfArrayBuffer);
                }
            }
        
            // Check if at least two PDF files are selected
            if (pdfArrayBuffers.length < 2) {
                alert('Please select at least two PDF files to merge.');
                return;
            }
        
            const mergedPdfBuffer = await mergePdfs(pdfArrayBuffers);
        
            const pdfBlob = new Blob([mergedPdfBuffer], { type: 'application/pdf' });
            const pdfUrl = URL.createObjectURL(pdfBlob);
        
            const link = document.createElement('a');
            link.href = pdfUrl;
        
            // If the user provided a file name, use it; otherwise, default to 'merged.pdf'
            if (fileName && fileName.trim() !== '') {
                link.download = `${fileName}.pdf`;
            } else {
                link.download = 'merged.pdf';
            }
        
            link.click();
        }
        
 
       async function mergePdfs(pdfsToMerge) {
            const mergedPdf = await PDFLib.PDFDocument.create();

            const actions = pdfsToMerge.map(async pdfBuffer => {
                const pdf = await PDFLib.PDFDocument.load(pdfBuffer);
                const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                copiedPages.forEach(page => {
                    mergedPdf.addPage(page);
                });
            });

            await Promise.all(actions);

            return await mergedPdf.save();
        }

        // Function to update file name next to the input field
        function updateFileName(inputId, fileNameId) {
            const fileInput = document.getElementById(inputId);
            const fileNameSpan = document.getElementById(fileNameId);
            if (fileInput.files.length > 0) {
                const fileName = fileInput.files[0].name;
                fileNameSpan.textContent = fileName;
                fileNameSpan.style.display = 'inline'; // Ensure the label is visible
            }
        }

        // Add event listener to toggle visibility of subsequent input fields
        for (let i = 2; i <= 10; i++) {
            document.getElementById('pdf' + i).addEventListener('change', function() {
                const nextInputId = 'pdf' + (i + 1);
                const nextInput = document.getElementById(nextInputId);
                const nextLabel = document.getElementById('label' + (i + 1));
                if (this.files.length > 0 && nextInput) {
                    nextInput.style.display = 'inline-block';
                    nextLabel.style.display = 'inline-block';
                }
            });
        }

        // Function to remove all input fields and reset visibility
        function removeAllInputs() {
            for (let i = 1; i <= 10; i++) {
                const fileInput = document.getElementById('pdf' + i);
                const fileInputLabel = document.getElementById('label' + i);
                const fileNameSpan = document.getElementById('file' + i + 'Name');
                fileInput.value = ''; // Clear the input value
                fileInputLabel.textContent = ''; // Clear the file name display
                fileNameSpan.textContent = ''; // Clear the file name display
                if (i > 2) {
                    fileInput.style.display = 'none'; // Hide input fields beyond the first two
                    fileInputLabel.style.display = 'none'; // Hide labels for input fields beyond the first two
                }
            }
        }
    </script>
</body>
</html>
